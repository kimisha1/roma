<script>
  const $ = (id) => document.getElementById(id);
  $('run').addEventListener('click', async () => {
    const prompt = $('prompt').value.trim();
    if (!prompt) { alert('Please enter a prompt'); return; }
    $('status').textContent = 'Running...';
    $('result').textContent = '';
    try {
      const res = await fetch('/api/run', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt })
      });
      const ct = res.headers.get('content-type') || '';
      const body = ct.includes('application/json') ? await res.json() : await res.text();
      $('result').textContent = typeof body === 'string' ? body : (body.result ?? JSON.stringify(body, null, 2));
    } catch (e) {
      $('result').textContent = 'Error: ' + (e?.message || e);
    } finally {
      $('status').textContent = '';
    }
  });
</script>
